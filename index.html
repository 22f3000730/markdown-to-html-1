<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown to HTML Converter</title>
    <!-- Include Marked.js from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Include Highlight.js from CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <style>
        #markdown-tabs {
            margin-bottom: 15px;
        }
        
        #markdown-tabs button {
            padding: 10px 15px;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            cursor: pointer;
            margin-right: 5px;
        }
        
        #markdown-tabs button.active {
            background-color: #007bff;
            color: white;
        }
        
        #markdown-output, #markdown-source {
            border: 1px solid #ddd;
            padding: 15px;
            min-height: 300px;
            display: none;
        }
        
        #markdown-output.active, #markdown-source.active {
            display: block;
        }
        
        #markdown-source {
            white-space: pre-wrap;
            font-family: monospace;
            background-color: #f8f9fa;
        }
        
        #markdown-word-count {
            margin-top: 10px;
            font-weight: bold;
            color: #333;
        }
        
        #markdown-source-label {
            margin-top: 10px;
            font-style: italic;
            color: #666;
        }
    </style>
</head>
<body>
    <div id="markdown-tabs">
        <button id="tab-html" class="active">HTML Output</button>
        <button id="tab-markdown">Markdown Source</button>
    </div>
    
    <div id="markdown-output" class="active"></div>
    <div id="markdown-source"></div>
    <div id="markdown-word-count"></div>
    <div id="markdown-source-label"></div>

    <script>
        // Tab switching functionality
        document.getElementById('tab-html').addEventListener('click', function() {
            document.getElementById('tab-html').classList.add('active');
            document.getElementById('tab-markdown').classList.remove('active');
            document.getElementById('markdown-output').classList.add('active');
            document.getElementById('markdown-source').classList.remove('active');
        });
        
        document.getElementById('tab-markdown').addEventListener('click', function() {
            document.getElementById('tab-markdown').classList.add('active');
            document.getElementById('tab-html').classList.remove('active');
            document.getElementById('markdown-source').classList.add('active');
            document.getElementById('markdown-output').classList.remove('active');
        });
        
        let originalMarkdown = '';
        
        // Function to update word count with formatting
        function updateWordCount(markdown) {
            // Count words (split by whitespace and filter out empty strings)
            const wordCount = markdown.trim() === '' ? 0 : markdown.trim().split(/\s+/).length;
            
            // Format number with commas using Intl.NumberFormat
            const formatter = new Intl.NumberFormat();
            const formattedCount = formatter.format(wordCount);
            
            // Update the badge
            document.getElementById('markdown-word-count').textContent = `Word Count: ${formattedCount}`;
        }
        
        // Function to update source label
        function updateSourceLabel(url) {
            document.getElementById('markdown-source-label').textContent = `Source: ${url}`;
        }
        
        // Get URL parameter
        const urlParams = new URLSearchParams(window.location.search);
        const url = urlParams.get('url');
        
        // Determine source
        const sourceUrl = url || 'data:text/markdown;base64,IyBBUEkgRG9jdW1lbnRhdGlvbiBFeGFtcGxlCgpUaGlzIG1hcmtkb3duIGZpbGUgaXMgZGVzaWduZWQgdG8gKip0ZXN0IHlvdXIgTWFya2Rvd24tdG8tSFRNTCBjb252ZXJzaW9uIEFQSSoqLiAgCkl0IGluY2x1ZGVzIHZhcmlvdXMgZm9ybWF0dGluZyBlbGVtZW50cyB0byBlbnN1cmUgZnVsbCBjb3ZlcmFnZS4KCiMjIE92ZXJ2aWV3CgpZb3VyIEFQSSBzaG91bGQ6CgoxLiBSZWFkIHRoaXMgbWFya2Rvd24gZmlsZS4KMi4gQ29udmVydCBpdCBpbnRvIHZhbGlkIEhUTUwuCjMuIEFwcGx5IHN5bnRheCBoaWdobGlnaHRpbmcgdG8gY29kZSBibG9ja3MgdXNpbmcgKipoaWdobGlnaHQuanMqKi4KCi0tLQoKIyMjIEV4YW1wbGUgUHl0aG9uIENvZGUKCmBgYHB5dGhvbgppbXBvcnQgcmVxdWVzdHMKCmRlZiBmZXRjaF91c2VyKHVzZXJuYW1lKToKICAgIHVybCA9IGYiaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS91c2Vycy97dXNlcm5hbWV9IgogICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQodXJsKQogICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKQoKcHJpbnQoZmV0Y2hfdXNlcigib2N0b2NhdCIpKQpgYGA=';
        
        // Update source label
        updateSourceLabel(sourceUrl);
        
        // Fetch the markdown file
        fetch(sourceUrl)
        .then(response => response.text())
        .then(markdown => {
            originalMarkdown = markdown;
            
            // Display raw markdown in source tab
            document.getElementById('markdown-source').textContent = markdown;
            
            // Convert markdown to HTML using marked
            const html = marked.parse(markdown);
            
            // Insert the HTML into the #markdown-output element
            document.getElementById('markdown-output').innerHTML = html;
            
            // Apply syntax highlighting to code blocks
            hljs.highlightAll();
            
            // Update word count
            updateWordCount(markdown);
        })
        .catch(error => console.error('Error loading markdown file:', error));
    </script>
</body>
</html>